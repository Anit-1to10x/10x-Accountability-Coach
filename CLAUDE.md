# 10X Accountability Coach - Claude Code Instructions

## ARCHITECTURE

This is a **dual-system** app:
- **CLI (Claude Code / Open Code)** = Brain — creates content via 37 slash commands, writes to `data/` files
- **UI (localhost:3000)** = Display — reads `data/` files, shows in browser, enables interaction
- **OpenAnalyst API** = Dual AI — powers both CLI and UI with context-aware chat
- **Local Files** = Data layer — all data in `./data/`, chat history persisted to disk

Commands exist in **both locations** for compatibility:
- `.claude/commands/` — For Claude Code CLI
- `commands/` — For Open Code UI and free models (Victoire, Kimi 2.5, etc.)

**PORT 3000 IS STRICTLY REQUIRED.** If port 3000 is not available, kill existing processes before starting. The app MUST run on port 3000.

---

## IMPORTANT: SETUP RULES — READ BEFORE DOING ANYTHING

**STRICT RULES FOR AI:**
1. **DO NOT explore, search, or read files** during setup unless explicitly listed below.
2. **DO NOT run alternative commands.** Only run the EXACT commands listed in each step.
3. **DO NOT install global packages.** Everything uses `npx` or local `npm install`.
4. **DO NOT use platform-specific commands** like `rm -rf`, `del /q`, `cat`, `echo >`, `type`.
5. **If a step fails, STOP and tell the user.** Do NOT improvise a different approach.
6. **Only try an alternative approach if EVERY command in the listed step has failed.**
7. **The app MUST run on port 3000.** No other port is acceptable.

---

## SETUP DETECTION

**Step 0: Read `.setup-log.json` using the Read tool (NOT bash).**

- If file exists AND `setupComplete` is `true` → Go to **RETURNING USER FLOW**
- If file does not exist OR `setupComplete` is `false` → Go to **FULL SETUP FLOW**

**That's it. No other files need to be read at this point.**

---

## FULL SETUP FLOW (First Time / Fresh Clone)

**Triggers:** User says "set up", "install", "start my app", "clone and set up", or similar AND setup is not complete.

### Step 1: Detect OS + Node version

**Run this ONE command:**
```bash
node -e "console.log(JSON.stringify({platform: process.platform, arch: process.arch, nodeVersion: process.version}))"
```
Save the output values. Do NOT run any other detection commands.

### Step 2: Ask TWO questions using AskUserQuestion tool

**Question 1 — Data Source:**
- Option A: **Local Files (Recommended)** — Data stored in `./data` folder. No external setup needed.
- Option B: **Supabase Cloud Database** — For Vercel deployment or multi-device sync.

If user picks Supabase, also ask for:
- Supabase Project URL (e.g., `https://xxxxx.supabase.co`)
- Supabase Anon Key

**Question 2 — API Key:**
- Ask: "Paste your OpenAnalyst API key (starts with `sk-oa-v1-`). Get one free at https://10x.in/dashboard"
- Validate: key MUST start with `sk-oa-v1-`. If not, ask again. Do NOT proceed without a valid key.

### Step 3: Install dependencies

**Run this ONE command from the project root:**
```bash
npm install
```
This automatically installs both root AND ui dependencies (root `package.json` has `postinstall: "cd ui && npm install"`).

**DO NOT run `cd ui && npm install` separately. DO NOT run `npm install` inside the `ui/` folder. The single root `npm install` handles everything.**

If `npm install` fails:
1. Tell the user the exact error message
2. STOP. Do NOT try alternative install commands

**After install succeeds, record versions with this ONE command:**
```bash
node -e "console.log('Node:', process.version); const {execSync} = require('child_process'); console.log('NPM:', execSync('npm --version').toString().trim())"
```

### Step 4: Create environment file

**Use the Write tool to create `ui/.env.local` with this EXACT content** (replace placeholders with actual values from Step 2):

```env
# 10X ACCOUNTABILITY COACH - Generated by Setup
OPENANALYST_API_URL=https://api.openanalyst.com/api
OPENANALYST_API_KEY=<ACTUAL_USER_API_KEY>
OPENANALYST_MODEL=openanalyst-beta
DATA_SOURCE=<local_or_supabase>
SUPABASE_URL=<ACTUAL_URL_OR_EMPTY>
SUPABASE_ANON_KEY=<ACTUAL_KEY_OR_EMPTY>
```

**Use the Write tool. Do NOT use echo, cat, or any bash command to create this file.**

### Step 5: Update setup log

**Use the Write tool to write `.setup-log.json` with this content** (fill in actual values):

```json
{
  "setupComplete": true,
  "setupDate": "<ISO_TIMESTAMP>",
  "platform": "<win32|darwin|linux>",
  "nodeVersion": "<from step 1>",
  "npmVersion": "<from step 3>",
  "dataSource": "<local|supabase>",
  "dependencies": {
    "root": { "installed": true, "installedAt": "<ISO_TIMESTAMP>" },
    "ui": { "installed": true, "installedAt": "<ISO_TIMESTAMP>" }
  },
  "configuration": {
    "apiKeyConfigured": true,
    "supabaseConfigured": false,
    "envFileCreated": true
  },
  "firstRun": {
    "profileCreated": false,
    "onboardingComplete": false
  },
  "logs": ["<ISO_TIMESTAMP> - Setup completed successfully"]
}
```

### Step 6: Start the application

**Run these TWO commands in sequence:**
```bash
npx kill-port 3000
```
Then:
```bash
cd ui && npm run dev
```

Run the dev server in the background. Wait for "Ready" in output.

**If the app starts on any port other than 3000:** kill port 3000 with `npx kill-port 3000` and restart. The app MUST run on port 3000.

### Step 7: Tell the user

**Say exactly this:**

> **Setup Complete!** Your 10X Accountability Coach is running at **http://localhost:3000**
>
> Open the link to create your profile and start your first challenge.
> Your terminal is ready for slash commands — type `/help` to see all 37 commands.

**Setup is done. Do NOT read any more files. Do NOT explore the codebase. Wait for the user's next request.**

---

## RETURNING USER FLOW

**Triggers:** `.setup-log.json` exists AND `setupComplete` is `true`.

**Run these TWO commands in sequence. Nothing else.**

```bash
npx kill-port 3000
```
Then:
```bash
cd ui && npm run dev
```

Run the dev server in the background. Wait for "Ready" in output.

**Say:** "Your app is running at http://localhost:3000. Terminal is ready for slash commands (`/help` to see all 37)."

**Do NOT ask questions. Do NOT read other files. Do NOT explore. Just start the app.**

---

## FRESH START / RESET

**Triggers:** User says "fresh start", "reset", "start over".

**Run these TWO commands:**
```bash
npx kill-port 3000
```
Then:
```bash
npx rimraf .setup-log.json data/profiles data/todos data/checkins data/.registry data/.responses data/chats data/agents
```

**Say:** "App reset complete. Say 'start my app' to run setup again."

**Do NOT delete anything else. Do NOT touch `data/challenges/`, `data/agents.json`, `skills/`, or `commands/`.**

---

## COMMAND REFERENCE (Windows-safe, cross-platform)

These are the ONLY shell commands the AI should run during setup:

| Action | Exact Command |
|--------|---------------|
| Detect OS | `node -e "console.log(JSON.stringify({platform: process.platform, arch: process.arch, nodeVersion: process.version}))"` |
| Install all deps | `npm install` (from project root — installs root + ui via postinstall) |
| Get versions | `node -e "console.log('Node:', process.version); const {execSync} = require('child_process'); console.log('NPM:', execSync('npm --version').toString().trim())"` |
| Kill port 3000 | `npx kill-port 3000` |
| Start dev server | `cd ui && npm run dev` |
| Delete files/dirs | `npx rimraf <path>` |
| Kill multiple ports | `npx kill-port 3000 3001 3002` |
| Clear Next.js cache | `npx rimraf ui/.next` |
| Rebuild | `cd ui && npm run build` |

**FORBIDDEN commands (never use these):**
- `rm -rf` / `rm -r` (Unix only, fails on Windows)
- `del /q` / `rmdir /s /q` (Windows CMD only, fails in bash)
- `cat` / `echo >` / `type` (use Read/Write tools instead)
- `sudo` (never needed)
- `npm install -g` (never install globally)
- `cd ui && npm install` (root npm install handles this via postinstall)

---

## FILE STRUCTURE

```
10x-Accountability-Coach/
├── .setup-log.json          # Setup tracking (created during setup)
├── .gitignore               # Git ignore rules
├── CLAUDE.md                # THIS FILE - instructions for all AI CLIs
├── README.md                # User documentation
├── opencode.json            # OpenCode configuration
├── package.json             # Root dependencies
│
├── .claude/                 # Claude Code CLI configuration
│   ├── commands/            # Slash commands (Claude Code CLI)
│   ├── instructions.md      # Startup behavior
│   ├── mcp.json             # MCP server config (git-ignored)
│   └── settings.local.json  # Permissions (git-ignored)
│
├── .opencode/               # OpenCode CLI configuration
│   ├── agents/              # Agent definitions (coach.md, setup.md)
│   ├── commands/            # Slash commands (OpenCode CLI)
│   └── skills/              # Skills with OpenCode frontmatter
│
├── commands/                # Slash commands (root - for any CLI / free models)
│   ├── _format.md          # Tag format reference
│   └── *.md                # 37 command files
│
├── ui/                      # Next.js frontend
│   ├── .env.local          # Environment config (created during setup)
│   ├── app/                # Pages & API routes
│   │   ├── api/chat/stream/ # SSE streaming with conversation history
│   │   ├── api/agents/      # Agent CRUD
│   │   └── (shell)/         # 17+ app pages
│   ├── components/         # React components
│   ├── lib/                # Utilities & stores
│   └── package.json        # UI dependencies
│
├── data/                   # Data storage (local files)
│   ├── config.json         # App configuration
│   ├── agents.json         # Agent registry
│   ├── agent-capabilities.json # Agent skills/personality
│   ├── agents/             # Agent workspaces (runtime)
│   ├── challenges/         # Challenge templates (30-day content)
│   ├── chats/              # Chat history (runtime, per date)
│   ├── profiles/           # User profiles (runtime)
│   ├── todos/              # User todos (runtime)
│   ├── checkins/           # Check-in records (runtime)
│   └── schemas/            # Supabase SQL schemas
│
├── skills/                 # AI Skill definitions (20+ skills)
└── commands/               # Slash command definitions (37 commands)
```

---

## CRITICAL: FILES TO PRESERVE

**NEVER delete these - they contain app functionality:**
- `data/challenges/` - Challenge templates with 30-day content
- `data/agents.json` - AI agent configurations
- `data/agent-capabilities.json` - Agent capabilities
- `data/schemas/` - Supabase database schemas
- `skills/` - All skill definitions
- `commands/` - Slash command definitions (root - for Open Code / free models)
- `.claude/commands/` - Slash command definitions (for Claude Code CLI)
- `.claude/instructions.md` - Claude Code startup instructions

**These are USER DATA - can be deleted for fresh start:**
- `data/profiles/` - User profile data
- `data/todos/` - User todos
- `data/checkins/` - Check-in records
- `data/chats/` - Chat conversation history
- `data/agents/` - Agent workspace data (NOT agents.json)
- `data/.registry/` - Registry data
- `data/.responses/` - Cached responses

---

## DATA SOURCE CONFIGURATION

### Local Mode (Default)
- All data stored in `./data` folder
- Profile data in `data/profiles/{profile-id}/`
- No internet required for data operations
- Best for personal/local use

### Supabase Mode
- All data synced to Supabase cloud
- Required env vars: `SUPABASE_URL`, `SUPABASE_ANON_KEY`
- User must run `data/schemas/full_schema.sql` in Supabase
- Best for Vercel deployment or multi-device sync

### Switching Data Sources
1. Update `DATA_SOURCE` in `ui/.env.local`
2. If switching to Supabase, add credentials
3. Restart the app: `npx kill-port 3000 && cd ui && npm run dev`

---

## COMMON USER COMMANDS

| User Says | Claude Code Action |
|-----------|-------------------|
| "clone and set up" | Clone repo + Full setup flow |
| "start my app" | Check setup log → Start or Setup |
| "run the app" | Same as "start my app" |
| "fresh start" / "reset" | Delete setup log + user data → Re-setup |
| "switch to supabase" | Update .env.local with Supabase credentials |
| "update API key" | Update OPENANALYST_API_KEY in .env.local |
| "stop the server" | `npx kill-port 3000` |

---

## TROUBLESHOOTING

### "API Disconnected" in Settings
1. Check `ui/.env.local` has valid API key (not placeholder)
2. Restart: `npx kill-port 3000 && cd ui && npm run dev`

### Port Already in Use
```bash
npx kill-port 3000 3001 3002
cd ui && npm run dev
```

### Dependencies Issues
```bash
npx rimraf node_modules ui/node_modules
npm install && cd ui && npm install
```

### Setup Not Working
```bash
# Delete setup log and try again
npx rimraf .setup-log.json
# Then say "start my app"
```

### Build Errors
```bash
cd ui && npx rimraf .next && npm run build
```

---

## GIT IGNORE (These should NOT be committed)

The following are automatically ignored:
- `.setup-log.json` - Local setup state
- `ui/.env.local` - API keys and secrets
- `data/profiles/` - User data
- `data/todos/` - User todos (non-profile)
- `data/checkins/` - User check-ins (non-profile)
- `data/chats/` - Chat conversation history
- `data/agents/` - Agent workspace data
- `data/.responses/` - Cached responses
- `data/.registry/` - Registry data
- `node_modules/` - Dependencies

---

## API KEY INFORMATION

### Where to Get API Key
1. Visit **https://10x.in/dashboard**
2. Enter email address
3. Receive API key via email

### API Key Format
```
sk-oa-v1-xxxxxxxxxxxxxxxxxxxxxxxx
```

### Validation
- Must start with `sk-oa-v1-`
- Should be ~40+ characters
- Never share or commit to git

---

## SKILLS SYSTEM

20+ skills for structured operations:

### Slash Commands

#### Streaks & Challenges
- `/streak` - Check in to active challenge
- `/streak-new` - Create new challenge
- `/streak-list` - List all challenges
- `/streak-stats` - View statistics
- `/streak-switch` - Switch active challenge
- `/streak-insights` - Cross-challenge insights
- `/challenge` - Browse challenge templates

#### Agents
- `/agent` - View all agents
- `/agent-new` - Create a new custom agent
- `/agent-edit` - Edit agent personality, skills, prompts
- `/agent-skills` - Manage agent's assigned skills
- `/agent-delete` - Delete an agent
- `/agent-chat` - Start chatting with a specific agent
- `/agent-ref` - Add reference files to an agent

#### Todos & Schedule
- `/todo` - View all todos
- `/todo-add` - Add a new todo
- `/todo-list` - List todos with filters
- `/todo-complete` - Mark todo as done
- `/schedule` - View your schedule
- `/reschedule` - Reschedule a task

#### Check-ins & Motivation
- `/checkin` - Daily accountability check-in
- `/checkin-history` - View check-in history
- `/motivate` - Get a motivation boost

#### Planning & Vision
- `/plan` - View active plan
- `/plan-new` - Create a new plan
- `/visionboard` - View vision board
- `/visionboard-new` - Create a vision board

#### Accountability
- `/contract` - Create/view accountability contract
- `/punishment` - Manage consequences

#### Skills & Tools
- `/skill-list` - List all AI skills
- `/skill-new` - Create a custom skill
- `/prompt` - Manage prompt templates

#### Workspace & System
- `/workspace` - View workspace overview
- `/asset` - Manage assets
- `/history` - View activity history
- `/onboard` - Run onboarding setup
- `/help` - Show all commands

### How Skills Work
1. User types command or natural language
2. System matches to skill from `skills/` directory
3. Skill instructions injected into AI prompt
4. AI follows skill-specific behavior

### How Agents Work
1. User creates agent via `/agent-new` (CLI) or "+" button (UI)
2. Agent data stored in `data/agents.json` + `data/agent-capabilities.json`
3. Agent workspace created at `data/agents/{agent-id}/`
4. User selects agent in UI sidebar → chat uses agent's personality
5. Reference files in agent workspace provide context-aware responses

---

## CHAT SYSTEM

### Context-Aware Conversations
- Chat sends last 10 messages as history to API (~3000 token budget)
- Messages persist to `data/chats/{date}/{agentId}.md`
- System prompt includes: user profile, challenges, todos, streaks, agent personality
- Multi-turn conversations reference previous messages naturally

### Agent Personality in Chat
- Selected agent's tone, style, and skills shape every response
- Agent restrictions (allowOnlyAssigned) filter available prompts/skills
- Reference files in `data/agents/{id}/files/` provide domain knowledge

---

## COMMAND FORMAT

Commands use structured XML-like tags for efficient parsing (~500 tokens each):
```markdown
<cmd name="...">Description</cmd>
<ref>skills/relevant-skill/SKILL.md</ref>
<steps>1. Step one 2. Step two</steps>
<data path="...">JSON schema shorthand</data>
<output>What user sees</output>
```

This format works with Claude Code, Open Code, and free models (Victoire, Kimi 2.5).

---

## COMPATIBILITY

This project works as a skills plugin for **both** Claude Code and OpenCode.

### Claude Code CLI
- Config: `CLAUDE.md` (auto-loaded)
- Commands: `.claude/commands/*.md` (auto-loaded by Claude Code)
- Skills: `skills/` (referenced by commands)
- Instructions: `.claude/instructions.md`

### OpenCode CLI / UI
- Config: `opencode.json` (auto-loaded, references CLAUDE.md)
- Commands: `.opencode/commands/*.md` (auto-loaded by OpenCode)
- Skills: `.opencode/skills/*/SKILL.md` (with proper frontmatter: name + description)
- Agents: `.opencode/agents/*.md` (coach.md, setup.md)
- Also reads: `.claude/commands/` and `.claude/skills/` (OpenCode cross-compatible)

### Root `commands/` Directory
- Same commands, compatible with any AI CLI or free model (Victoire, Kimi 2.5, etc.)
- Tagged format (~500 tokens each) works efficiently with all model sizes

### All systems share:
- Same data directory (`./data/`)
- Same skills source (`./skills/`)
- Same agent configurations (`data/agents.json`, `data/agent-capabilities.json`)
- Same UI at localhost:3000
- Same `CLAUDE.md` instructions

### Directory Map
```
.claude/commands/     ← Claude Code reads these
.opencode/commands/   ← OpenCode reads these
commands/             ← Any CLI / free models read these
                        (All three contain identical command files)

.opencode/skills/     ← OpenCode reads these (with frontmatter)
.opencode/agents/     ← OpenCode agent definitions
skills/               ← Source of truth for all skills
```

---

## SUMMARY

**First-time setup (Fresh Clone):**
1. ✅ Detect OS automatically
2. ✅ Check setup log
3. ✅ Ask data source preference (local vs Supabase)
4. ✅ Ask for API key
5. ✅ Install all dependencies
6. ✅ Create environment file
7. ✅ Update setup log
8. ✅ Start the app on port 3000 (strict)
9. ✅ Guide to onboarding + show available commands

**Returning user:**
1. ✅ Check setup log → already complete
2. ✅ Kill port 3000 → Start the app
3. ✅ Terminal ready for slash commands

**User just needs to:**
1. Clone the repo
2. Open Claude Code OR Open Code
3. Say "start my app"
4. Answer setup questions (first time only)
5. Open http://localhost:3000
6. Use slash commands in terminal for creation
7. Use UI for viewing and interaction

---

*Developed by Team 10X | Powered by OpenAnalyst*
